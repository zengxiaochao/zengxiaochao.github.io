# CentOS7-ks.cfg系统安装与配置技巧

## 1. ks文件配置

1.CentOS 6.5宿主机系统安装及配置

在生产环境中，安装CentOS
6.5系统的宿主机，采用pxe方式来完成批量的宿主机部署。
下面分享一个宿主机安装kickstart文件的内容，是一个实际在生产环境中使用的。
```
# Kickstart file automatically generated by anaconda
#系统安装自动生成的

install
# Keyboard layouts
keyboard 'us'

# System language
lang en_US
# System authorization information
auth  --useshadow  --passalgo=sha512
# Use CDROM installation media
cdrom

# Use graphical install
graphical
firstboot --disable

#设置网络，装机的时候，一般第一个网卡使用dhcp分配IP，第二个网卡关闭
network --onboot yes --device eth0 --mtu=1500 --bootproto dhcp
network --onboot yes --device eth1 --noipv4 --noipv6

#配置系统密码 Root password
rootpw --iscrypted $1$uE0tbJgm$y8kjiD/HhTdN.IlsQHySj/

#文本方式安装，安装后重启
text
reboot

# 关闭防火墙
firewall --disabled


# SELinux configuration
selinux --disabled

##################################################
# Installation logging level
logging --level=info

# Do not configure the X Window System
skipx
##################################################
 #配置时区
timezone Asia/Shanghai



# Reboot after installation
# System timezone
timezone Asia/Shanghai --isUtc
# System bootloader configuration
bootloader --location=mbr --driveorder=sda --append=""
#清除硬盘数据，并创建相应分区
# Clear the Master Boot Record
zerombr
# Partition clearing information
clearpart --none


part /boot --fstype ext3 --size=256
part pv.3 --size=40960
part pv.4 --size=100 --grow
volgroup datavg --pesize=32768 pv.4
volgroup KVMvg --pesize=32768 pv.3

#此处创建了一个目录，用于存放虚拟机，笔者习惯的目录是/datapool
logvol /datapool --fstype ext4 --name=datapool --vgname=datavg --size=10240 --grow
logvol swap --fstype swap --name=swap --vgname=KVMvg --size=8192
logvol / --fstype ext4 --name=root --vgname=KVMvg --size=30720


%packages
#安装虚拟化需要的包，主要有：
@virtualization
@Base
@Core
@additional-devel
@base
@large-systems
@storage-client-iscsi
@system-management-snmp
@virtualization
@virtualization-client
@virtualization-platform
@virtualization-tools
#####################################################
%end

%post
#history size
cat >>/etc/bashrc <<EOF
HISTSIZE=2000
HISTFILESIZE=2000
HISTTIMEFORMAT="%Y-%m-%d %H:%M:%S "
EOF

# Set prompt
cat << EOF > /etc/issue
 _   _    _     _       ___  ___
| | / /  | |   / /     /   |/   |
| |/ /   | |  / /     / /|   /| |
| |\ \   | | / /     / / |__/ | |
| | \ \  | |/ /     / /       | |
|_|  \_\ |___/     /_/        |_|


EOF
cat << EOF > /etc/issue.net

 _   _    _     _       ___  ___
| | / /  | |   / /     /   |/   |
| |/ /   | |  / /     / /|   /| |
| |\ \   | | / /     / / |__/ | |
| | \ \  | |/ /     / /       | |
|_|  \_\ |___/     /_/        |_|

EOF

#!/bin/sh
# 设置Bash Color
echo 'PS1="\[\e[32;1m\][\u@\h \W]\\$ \[\e[0m\]"' >> /root/.bashrc
. /root/.bashrc
%end

```

使用上面的kickstart配置文件安装完宿主机系统，可以通过rpm-q命令检查一下具体安装了哪些包。
```
[root@localhost ~]# rpm -qa|grep -E 'qemu|libvirt|virt' 


#Libvirt的客户端，最重要的功能之一就是就在宿主机关机时可以通知虚拟机也关机，
#使虚拟机系统正常关机，而不是被强制关机，造成数据丢失
libvirt-client-0.10.2-29.el6.x86_64 




#虚拟机iPXE的启动固件，支持虚拟机从网络启动
gpxe-roms-qemu-0.9.7-6.10.el6.noarch 

#libvirt为Python提供的API
libvirt-python-0.10.2-29.el6.x86_64   

#一套Python的虚拟机安装工具
python-virtinst-0.600.0-18.el6.noarch  

#KVM在用户空间运行的程序
qemu-KVM-0.12.1.2-2.415.el6.x86_64 

#基于Libvirt 的图像化虚拟机管理软件
Virt-manager-0.9.0-19.el6.x86_64  

#用于管理虚拟机，它提供了一套虚拟机操作API
libvirt-0.10.2-29.el6.x86_64

#显示虚拟机的控制台console
virt-viewer-0.5.6-8.el6.x86_64  


#类似于top命令，查看虚拟机的资源使用情况
virt-top-1.0.4-3.15.el6.x86_64  

#在虚拟机内部执行，查看虚拟机运行的虚拟化平台
virt-what-1.11-1.2.el6.x86_64 

#用于操作虚拟机硬盘镜像的创建、查看和格式转化
qemu-img-0.12.1.2-2.415.el6.x86_64  
```

2.CentOS 7宿主机系统安装及配置

CentOS 7宿主机的安装与CentOS
6的系统安装方式类似，系统安装完之后，确认已经安装了如下的rpm相关包。Libvirt还包含了很多工具的库，可以使用yum
install libvirt*命令安装。



自动化安装centos7

```
#下载系统镜像
#http://mirrors.aliyun.com/centos/7/isos/x86_64/CentOS-7-x86_64-DVD-1708.iso

#使用ISO镜像 + ks文件自动化安装
#安装界面选择"Install CentOS7" 按TAB键进入编辑，添加自动化安装脚本 ks=http://elven.vip/ks/c7cd.ks
#按Enter开始自动化安装
```

ks文件自动化安装：http://elven.vip/ks/c7cd.ks



## 2.一些很方便的脚本

http://elven.vip/ks/

